!function(a){"use strict";var b,c=function(){b=this,this.audioContext=this.getAudioContext(),this.buffer=null,this.WEB_AUDIO_API_NOT_SUPPORTED=1001,this.REQUEST_PROGRESS=101,this.REQUEST_LOAD=102,this.REQUEST_ERROR=1102,this.REQUEST_ABORT=104;var a=Object.getNotifier(this);Object.defineProperty(this,"status",{get:function(){return parseInt(status,10)},set:function(b){b!==status&&(a.notify({type:"update",name:"status"}),status=b)}}),Object.observe(this,function(a){switch(b.status){case b.WEB_AUDIO_API_NOT_SUPPORTED:console.error("WEB_AUDIO_API_NOT_SUPPORTED");break;case b.REQUEST_PROGRESS:console.log("REQUEST_PROGRESS");break;case b.REQUEST_LOAD:console.log("REQUEST_LOAD");break;case b.REQUEST_ERROR:console.error("REQUEST_ERROR");break;case b.REQUEST_ABORT:console.error("REQUEST_ABORT");break;default:console.error("STATUS NOT IMPLEMENTED")}})};c.prototype.getAudioContext=function(){try{return a.AudioContext=a.AudioContext||a.webkitAudioContext,new a.AudioContext}catch(b){return this.status=this.WEB_AUDIO_API_NOT_SUPPORTED,null}},c.prototype.loadBufferFromURI=function(a,c){if(null===this.audioContext)return!1;c.onsuccess=c.onsuccess||function(){},c.onerror=c.onerror||function(){};var d=new XMLHttpRequest;return d.open("GET",a,!0),d.responseType="arraybuffer",d.addEventListener("progress",function(a){b._requestProgress(a)},!1),d.addEventListener("load",function(a){b._requestLoad(a,this,c)},!1),d.addEventListener("error",function(){b._requestError(event,this,c)},!1),d.addEventListener("abort",function(){b._requestAbort()},!1),d.send(null),!0},c.prototype._requestProgress=function(a){this.status=this.REQUEST_PROGRESS,a.lengthComputable},c.prototype._requestLoad=function(a,b,c){200===b.status?(this.buffer=b.response,this.status=this.REQUEST_LOAD,c.onsuccess(this)):this._requestError(a,b,c)},c.prototype._requestError=function(a,b,c){this.status=this.REQUEST_ERROR,c.onerror(b)},c.prototype._requestAbort=function(){this.status=this.REQUEST_ABORT},c.prototype.process=function(){this.audioContext.decodeAudioData(this.buffer,this.processBpm,function(a){b.status=b.DECODING_ERROR})},c.prototype.getOfflineContext=function(b){var c=new a.OfflineAudioContext(1,b.length,b.sampleRate),d=c.createBufferSource(),e=c.createBiquadFilter();return d.buffer=b,e.type="lowpass",d.connect(e),e.connect(c.destination),d.start(0),c},c.prototype.processBpm=function(){var a=b.getOfflineContext(b.buffer);a.oncomplete=function(a){},a.startRendering()},c.prototype.getChannelDataMinMax=function(a){var b,c=a.length,d=a[0],e=a[0];for(b=1;c>b;b++)d=Math.min(d,a[b]),e=Math.max(e,a[b])},c.prototype.getPeaks=function(a){var b=a.renderedBuffer.getChannelData(0),c=this.getChannelDataMinMax(b),d=230,e=Math.abs(c.min)+Math.abs(c.max),f=c.min+.9*e,g=c.min+.3*e,h=f,i=a.renderedBuffer.sampleRate*(d/1e3);for(peakFilter=[];h>=g&&peakFilter.length<=parseInt(this.buffer.duration,10);){for(j=0;j<length;j++)b[j]>h&&(peakFilter.push(j),j+=i);h-=.05}return peakFilter.sort(function(a,b){return a-b}),peakFilter},a.Pulse=c}(window);